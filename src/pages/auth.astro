---
import Layout from '@/layouts/Layout.astro'
---

<Layout
    title="Autenticación - Miss Kdosh 2025"
    description="Inicia sesión o crea tu cuenta para votar en Miss Kdosh 2025"
>
    <main class="relative flex min-h-screen items-center justify-center px-4 py-24">
        <div class="pointer-events-none absolute inset-0 overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-b from-transparent via-theme-tickle-me-pink/20 to-theme-turquoise/20"></div>
            <div class="absolute top-0 left-1/2 h-96 w-96 -translate-x-1/2 rounded-full bg-theme-tickle-me-pink/30 blur-3xl"></div>
            <div class="absolute bottom-0 right-0 h-96 w-96 rounded-full bg-theme-turquoise/20 blur-3xl"></div>
        </div>

        <div class="relative z-10 w-full max-w-md backdrop-blur-sm rounded-2xl border border-white/10 bg-theme-raisin-black/70 px-8 py-10 shadow-2xl">
        <div class="mb-8 flex gap-4 border-b border-theme-tickle-me-pink/40">
            <button
            id="loginTab"
            class="tab-button active px-6 pb-4 text-lg font-semibold transition-all duration-300 text-theme-tickle-me-pink"
            data-tab="login"
            >
            Iniciar Sesión
            </button>
            <button
            id="registerTab"
            class="tab-button px-6 pb-4 text-lg font-semibold transition-all duration-300 text-theme-seashell/60 hover:text-theme-seashell"
            data-tab="register"
            >
            Crear Cuenta
            </button>
        </div>

        <form id="loginForm" class="tab-content space-y-6">
            <div>
            <label for="loginEmail" class="text-theme-seashell mb-2 block text-sm font-medium">
                Email
            </label>
            <input
                id="loginEmail"
                type="email"
                required
                autocomplete="email"
                class="w-full rounded-lg border border-theme-tickle-me-pink/40 bg-theme-raisin-black/50 px-4 py-3 text-theme-seashell placeholder-gray-400 transition duration-300 focus:border-theme-tickle-me-pink focus:bg-theme-raisin-black/70 focus:outline-none focus:ring-2 focus:ring-theme-tickle-me-pink/20"
                placeholder="tu email.com"
            />
            </div>

            <div>
            <label for="loginPassword" class="text-theme-seashell mb-2 block text-sm font-medium">
                Contraseña
            </label>
            <input
                id="loginPassword"
                type="password"
                required
                autocomplete="current-password"
                class="w-full rounded-lg border border-theme-tickle-me-pink/40 bg-theme-raisin-black/50 px-4 py-3 text-theme-seashell placeholder-gray-400 transition duration-300 focus:border-theme-tickle-me-pink focus:bg-theme-raisin-black/70 focus:outline-none focus:ring-2 focus:ring-theme-tickle-me-pink/20"
                placeholder="••••••••"
            />
            </div>

            <button
            type="submit"
            class="from-theme-tickle-me-pink to-theme-turquoise neon-text w-full rounded-lg bg-gradient-to-r py-3 font-bold text-black transition duration-300 hover:opacity-90"
            >
            Inicia Sesión
            </button>
        </form>

        <form id="registerForm" class="tab-content hidden space-y-6">
            <div>
            <label for="registerName" class="text-theme-seashell mb-2 block text-sm font-medium">
                Nombre Completo
            </label>
            <input
                id="registerName"
                type="text"
                required
                autocomplete="name"
                class="w-full rounded-lg border border-theme-tickle-me-pink/40 bg-theme-raisin-black/50 px-4 py-3 text-theme-seashell placeholder-gray-400 transition duration-300 focus:border-theme-tickle-me-pink focus:bg-theme-raisin-black/70 focus:outline-none focus:ring-2 focus:ring-theme-tickle-me-pink/20"
                placeholder="Tu nombre"
            />
            </div>

            <div>
            <label for="registerEmail" class="text-theme-seashell mb-2 block text-sm font-medium">
                Email
            </label>
            <input
                id="registerEmail"
                type="email"
                required
                autocomplete="email"
                class="w-full rounded-lg border border-theme-tickle-me-pink/40 bg-theme-raisin-black/50 px-4 py-3 text-theme-seashell placeholder-gray-400 transition duration-300 focus:border-theme-tickle-me-pink focus:bg-theme-raisin-black/70 focus:outline-none focus:ring-2 focus:ring-theme-tickle-me-pink/20"
                placeholder="tu email.com"
            />
            </div>

            <div>
            <label for="registerPassword" class="text-theme-seashell mb-2 block text-sm font-medium">
                Contraseña
            </label>
            <input
                id="registerPassword"
                type="password"
                required
                autocomplete="new-password"
                class="w-full rounded-lg border border-theme-tickle-me-pink/40 bg-theme-raisin-black/50 px-4 py-3 text-theme-seashell placeholder-gray-400 transition duration-300 focus:border-theme-tickle-me-pink focus:bg-theme-raisin-black/70 focus:outline-none focus:ring-2 focus:ring-theme-tickle-me-pink/20"
                placeholder="••••••••"
            />
            </div>

            <div>
            <label
                for="registerConfirmPassword"
                class="text-theme-seashell mb-2 block text-sm font-medium"
            >
                Confirmar Contraseña
            </label>
            <input
                id="registerConfirmPassword"
                type="password"
                required
                autocomplete="new-password"
                class="w-full rounded-lg border border-theme-tickle-me-pink/40 bg-theme-raisin-black/50 px-4 py-3 text-theme-seashell placeholder-gray-400 transition duration-300 focus:border-theme-tickle-me-pink focus:bg-theme-raisin-black/70 focus:outline-none focus:ring-2 focus:ring-theme-tickle-me-pink/20"
                placeholder="••••••••"
            />
            </div>

            <button
            type="submit"
            class="from-theme-turquoise to-theme-tickle-me-pink neon-text w-full rounded-lg bg-gradient-to-r py-3 font-bold text-black transition duration-300 hover:opacity-90"
            >
            Crear Cuenta
            </button>
        </form>

        <div
            id="successMessage"
            class="hidden rounded-lg border border-green-500/40 bg-green-900/30 px-4 py-3 text-center text-green-200"
        >
            ¡Autenticación exitosa! Redirigiendo
        </div>
        </div>
    </main>
</Layout>

<style>
.tab-button.active {
    border-bottom: 2px solid #ff4f9f;
    color: #ff4f9f;
}

.tab-button:not(.active) {
    border-bottom: 2px solid transparent;
}
</style>

<script>
import { $ } from '@/lib/dom-selector'

document.addEventListener('astro:page-load', () => {
    const loginTab = $('#loginTab')
    const registerTab = $('#registerTab')
    const loginForm = $('#loginForm')
    const registerForm = $('#registerForm')
    const successMessage = $('#successMessage')

    loginTab?.addEventListener('click', () => {
        loginTab.classList.add('active')
        registerTab?.classList.remove('active')
        loginForm?.classList.remove('hidden')
        registerForm?.classList.add('hidden')
    })

    registerTab?.addEventListener('click', () => {
        registerTab.classList.add('active')
        loginTab?.classList.remove('active')
        registerForm?.classList.remove('hidden')
        loginForm?.classList.add('hidden')
    })

    loginForm?.addEventListener('submit', (e) => {
        e.preventDefault()
        const email = (document.getElementById('loginEmail') as HTMLInputElement).value
        const password = (document.getElementById('loginPassword') as HTMLInputElement).value

        localStorage.setItem('user', JSON.stringify({ email, authenticated: true }))
        showSuccess()
    })

    registerForm?.addEventListener('submit', (e) => {
        e.preventDefault()
        const name = (document.getElementById('registerName') as HTMLInputElement).value
        const email = (document.getElementById('registerEmail') as HTMLInputElement).value
        const password = (document.getElementById('registerPassword') as HTMLInputElement).value
        const confirmPassword = (
        document.getElementById('registerConfirmPassword') as HTMLInputElement
        ).value

        if (password !== confirmPassword) {
        alert('Las contraseñas no coinciden')
        return
        }

        localStorage.setItem('user', JSON.stringify({ name, email, authenticated: true }))
        showSuccess()
    })

    function showSuccess() {
        loginForm?.classList.add('hidden')
        registerForm?.classList.add('hidden')
        successMessage?.classList.remove('hidden')

        setTimeout(() => {
        window.location.href = '/'
        }, 1500)
    }
})
</script>
